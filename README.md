# üéØ Attendance Tracker PWA

**‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£**

Progressive Web App (PWA) ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ó‡∏µ‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö CMS ‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£

---

## ‚ú® ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏Å

### üì± ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
- **‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å** - ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö + ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å GPS ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- **‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢** - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö (‡∏Å‡∏•‡πà‡∏≠‡∏á/‡πÅ‡∏û‡πá‡∏Ñ/‡∏õ‡∏µ‡πä‡∏ö/‡∏ã‡∏≠‡∏á) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- **‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PC Daily** - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤, ‡∏†‡∏≤‡∏û‡∏ä‡∏±‡πâ‡∏ô‡∏ß‡∏≤‡∏á, ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô
- **‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å** - ‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô-‡∏õ‡∏£‡∏±‡∏ö‡∏¢‡∏≠‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏° FIFO tracking
- **PIN Authentication** - ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö

### üëî ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£
- **Dashboard ‡πÅ‡∏ö‡∏ö Real-time** - KPIs, ‡∏Å‡∏£‡∏≤‡∏ü, ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏° 7 ‡∏ß‡∏±‡∏ô
- **‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£** - ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô, ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢, ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö, ROI, ‡∏™‡∏ï‡πá‡∏≠‡∏Å
- **‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô/‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤** - CRUD + ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ + GPS geofencing
- **‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢** - ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
- **‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå** - Role-based access (employee/sales/admin/super_admin)

### üöÄ PWA Features
- **‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏õ** - Add to Home Screen
- **Auto-Update** - ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° Changelog
- **Offline-Ready** - Service Worker caching
- **Fast Loading** - Turbopack + Next.js 15

---

## üõ†Ô∏è Tech Stack

- **Framework:** Next.js 15 (App Router) + React 19
- **Language:** TypeScript (Strict Mode)
- **Styling:** Tailwind CSS v4
- **Database:** Supabase (PostgreSQL)
- **Storage:** Supabase Storage (Photos)
- **Auth:** PIN-based (bcrypt hashing)
- **State:** TanStack React Query
- **Charts:** Recharts
- **Maps:** Leaflet + React-Leaflet
- **PWA:** next-pwa

---

## üöÄ Quick Start

### 1. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Dependencies

```bash
npm install
```

### 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Environment

```bash
cp .env.example .env.local
```

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `.env.local`:

```env
# Supabase Configuration
SUPABASE_URL=your-project-url
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
SUPABASE_ATTENDANCE_BUCKET=attendance-photos

# Application Settings
APP_TIMEZONE=Asia/Bangkok
```

### 3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Supabase Database

‡∏£‡∏±‡∏ô‡πÑ‡∏ü‡∏•‡πå migrations ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô `migrations/` ‡∏ú‡πà‡∏≤‡∏ô Supabase SQL Editor (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö 001, 002, 003...)

**‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** ‡∏£‡∏±‡∏ô migrations ‡∏ó‡∏µ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç

### 4. ‡∏™‡∏£‡πâ‡∏≤‡∏á Storage Bucket

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Supabase Dashboard ‚Üí Storage
2. Create bucket ‡∏ä‡∏∑‡πà‡∏≠ `attendance-photos`
3. ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Public bucket ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î RLS policies

### 5. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤

```bash
npm run dev
```

‡πÄ‡∏õ‡∏¥‡∏î [http://localhost:3000](http://localhost:3000)

---

## üìÇ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏ï‡πå

```
attendance-pwa/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/                    # Next.js App Router
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx           # ‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sales/             # ‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stock/             # ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/             # ‡∏´‡∏ô‡πâ‡∏≤ Login (PIN)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/             # Admin Dashboard + CMS
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reports/       # ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ employees/     # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stores/        # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ products/      # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings/      # ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api/               # API Routes
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ attendance/    # API ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ sales/         # API ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ stock/         # API ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ auth/          # API Authentication
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ admin/         # API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Admin
‚îÇ   ‚îú‚îÄ‚îÄ components/            # Shared UI Components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UpdatePopup.tsx   # PWA Update Notification
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PINKeypad.tsx     # PIN Input Component
‚îÇ   ‚îú‚îÄ‚îÄ lib/                   # Business Logic & Utilities
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ configStore.ts    # Main data store
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ supabaseClient.ts # Supabase client factory
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ supabaseData.ts   # Query helpers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pinAuth.ts        # PIN authentication
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authSecurity.ts   # Security & audit logs
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serviceWorkerManager.ts  # PWA updates
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...               # Other utilities
‚îÇ   ‚îú‚îÄ‚îÄ contexts/             # React Contexts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.tsx   # Authentication state
‚îÇ   ‚îî‚îÄ‚îÄ types/                # TypeScript types
‚îÇ       ‚îî‚îÄ‚îÄ supabase.ts       # Supabase schema types
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ version.json          # Version tracking for PWA
‚îÇ   ‚îú‚îÄ‚îÄ manifest.json         # PWA manifest
‚îÇ   ‚îî‚îÄ‚îÄ icons/                # App icons
‚îú‚îÄ‚îÄ migrations/               # Supabase SQL migrations
‚îÇ   ‚îú‚îÄ‚îÄ 001_*.sql
‚îÇ   ‚îú‚îÄ‚îÄ 002_*.sql
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ data/                     # Local data (development only)
‚îÇ   ‚îú‚îÄ‚îÄ app-data.json        # Config data (legacy)
‚îÇ   ‚îú‚îÄ‚îÄ expenses.json        # Expense baselines
‚îÇ   ‚îî‚îÄ‚îÄ logs/                # Application logs
‚îî‚îÄ‚îÄ next.config.ts           # Next.js + PWA configuration
```

---

## üîê ‡∏£‡∏∞‡∏ö‡∏ö Authentication

### PIN-based Authentication
- **4-6 ‡∏´‡∏•‡∏±‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç** - bcrypt hashing
- **Rate Limiting** - ‡∏•‡πá‡∏≠‡∏Ñ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏´‡∏•‡∏±‡∏á 5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ú‡∏¥‡∏î
- **Audit Logs** - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏∏‡∏Å login attempt
- **Role-based Access:**
  - `employee` - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤, ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
  - `sales` - + ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢, ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PC
  - `admin` - + Dashboard, ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  - `super_admin` - + ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ, ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö

### ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ User PINs
```
/admin/user-pins
```
- ‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö PIN
- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó (role)
- ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï rate limit

---

## üìä Database Schema

### ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å

**attendance_records** - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å
- `recorded_date`, `recorded_time`, `status` (check-in/check-out)
- `employee_id`, `store_id`, `note`
- `latitude`, `longitude`, `accuracy`
- `photo_public_url`, `storage_path`

**sales_records** - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢
- `recorded_date`, `recorded_time`
- `employee_id`, `store_id`
- `product_id`, `unit_id`
- `quantity`, `unit_price`, `total_price`
- `price_type` (pc/company)

**employees** - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
- `name`, `employee_code`, `phone`
- `province`, `region`
- `regular_day_off`, `active_status`

**stores** - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
- `name`, `code`, `province`
- `latitude`, `longitude`, `radius` (geofencing)

**products** - ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
- `name`, `code`, `active_status`
- `category_id`

**product_units** - ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
- `product_id`, `name`, `sku`
- `is_base_unit`, `base_unit_multiplier`

**product_assignments** - ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
- `employee_id`, `product_id`, `store_id`
- `is_global` (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏£‡πâ‡∏≤‡∏ô)

**product_assignment_units** - ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢
- `assignment_id`, `unit_id`
- `price_pc`, `price_company`

**stock_inventory** - ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
- `employee_id`, `store_id`, `product_id`, `unit_id`
- `quantity` (non-negative constraint)

**stock_transactions** - ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏™‡∏ï‡πá‡∏≠‡∏Å
- `type` (receive/sale/return/adjustment)
- `quantity`, `balance_after`
- `sale_record_id` (link to sales)

**user_pins** - PIN Authentication
- `employee_id`, `pin_hash`, `role`

**auth_audit_logs** - Audit trail
- `employee_id`, `success`, `ip_address`, `user_agent`

**auth_rate_limits** - Failed login tracking
- `employee_id`, `failed_attempts`, `locked_until`

---

## üì± PWA Auto-Update System

### ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
1. **‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥** - Service Worker ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∏‡∏Å 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
2. **‡πÅ‡∏™‡∏î‡∏á Popup** - ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏° Changelog ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
3. **Update ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ** - ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏•‡∏¢" ‚Üí Reload
4. **‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏´‡∏°‡πà** - PWA icon ‡∏¢‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏°

### ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Version
‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `public/version.json`:

```json
{
  "version": "2.1.0",
  "buildDate": "2025-02-01T10:00:00+07:00",
  "releaseNotes": {
    "th": {
      "title": "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î",
      "highlights": [
        {
          "icon": "üÜï",
          "title": "‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà",
          "description": "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå"
        }
      ]
    }
  }
}
```

Git push ‚Üí Netlify deploy ‚Üí User ‡πÄ‡∏´‡πá‡∏ô popup ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!

---

## üé® ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å

### ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å
```
/ (‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å)
1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ (optional)
3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô/‡∏≠‡∏≠‡∏Å‡∏á‡∏≤‡∏ô)
4. ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)
5. GPS ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
6. ‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
```

### ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢
```
/sales
1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô + ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (filter ‡∏ï‡∏≤‡∏° assignment)
3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö + ‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
4. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å price type (PC/Company)
5. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
6. ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ + GPS
7. ‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
```

### Dashboard & Reports
```
/admin
- KPI cards (‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á, ‡∏Å‡∏≥‡πÑ‡∏£)
- ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏° 7 ‡∏ß‡∏±‡∏ô
- Top products/employees/stores
- Performance analytics

/admin/reports/*
- attendance - ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
- sales - ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢
- sales-comparison - ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
- products - ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ + ranking
- individual - ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
- roi - ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ROI ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
- pc-daily - ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PC Daily
- stock-movement - ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å
```

---

## üîß ‡∏Å‡∏≤‡∏£ Build & Deploy

### Development
```bash
npm run dev          # Turbopack dev server
```

### Production Build
```bash
npm run build        # Next.js production build
npm run start        # Serve production bundle
```

### TypeScript Check
```bash
npx tsc --noEmit     # Type checking only
```

### Linting
```bash
npm run lint         # ESLint check
```

### Generate Supabase Types
```bash
npm run gen:types    # Output to src/types/supabase.ts
```

### Deploy to Netlify
1. Connect GitHub repository
2. Set environment variables:
   - `SUPABASE_URL`
   - `SUPABASE_ANON_KEY`
   - `SUPABASE_SERVICE_ROLE_KEY`
   - `SUPABASE_ATTENDANCE_BUCKET`
   - `APP_TIMEZONE`
3. Deploy automatically on push to main

---

## üîê ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

### Data Security
- ‚úÖ PIN hashing ‡∏î‡πâ‡∏ß‡∏¢ bcrypt (10 rounds)
- ‚úÖ Rate limiting + account lockout
- ‚úÖ Audit logs ‡∏ó‡∏∏‡∏Å authentication attempt
- ‚úÖ Service role key ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ù‡∏±‡πà‡∏á server
- ‚úÖ Input validation ‡∏ó‡∏∏‡∏Å API endpoint

### Supabase RLS (Row Level Security)
- ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô RLS policies ‡∏ö‡∏ô‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á
- ‡πÅ‡∏¢‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ï‡∏≤‡∏° employee_id ‡πÅ‡∏•‡∏∞ role
- ‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô migrations files

### Environment Variables
- ‚ö†Ô∏è **‡∏´‡πâ‡∏≤‡∏°** commit `.env.local`
- ‚ö†Ô∏è **‡∏´‡πâ‡∏≤‡∏°** expose `SERVICE_ROLE_KEY` ‡πÉ‡∏´‡πâ client
- ‚úÖ ‡πÉ‡∏ä‡πâ `.env.example` ‡πÄ‡∏õ‡πá‡∏ô template

---

## üìñ Additional Resources

### Documentation
- `CLAUDE.md` - ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö AI/Developer
- `AGENTS.md` - AI Agent specifications
- `migrations/` - Database schema evolution

### API Reference
```
/api/attendance        # POST - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤
/api/sales             # POST - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢
/api/auth/login        # POST - PIN login
/api/admin/*           # Admin endpoints
/api/changelog         # GET - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• version
```

### Key Libraries
- `src/lib/configStore.ts` - Main data operations
- `src/lib/supabaseClient.ts` - Supabase client factory
- `src/lib/supabaseData.ts` - Query helpers
- `src/lib/pinAuth.ts` - PIN authentication
- `src/lib/serviceWorkerManager.ts` - PWA updates

---

## üöÄ Feature Roadmap

- [ ] Multi-language support (EN/TH switching)
- [ ] Push notifications (Supabase Realtime)
- [ ] Offline mode with sync queue
- [ ] Advanced geofencing alerts
- [ ] Integration with LINE OA
- [ ] Export to Google Sheets/Excel
- [ ] Mobile app (React Native)

---

## üìù License

Private project - All rights reserved

---

## üë• Support

For issues or questions:
1. Check `CLAUDE.md` for development guidelines
2. Review `migrations/` for schema reference
3. Check Supabase logs for debugging

---

**Made with ‚ù§Ô∏è using Next.js 15 + Supabase**
